<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElektroSys - Calculadora de Motores</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23FFD700'%3E%3Cpath d='M13 2L3 14h9l-1 8 10-12h-9l1-8z'/%3E%3C/svg%3E">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="ElektroSys | Dimensionamento de Cabos para Motores">
    <meta name="theme-color" content="#0f172a">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { brand: { dark: '#0f172a', blue: '#1e40af', text: '#1e293b' } }
                }
            }
        }
    </script>

    <style>
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #3b82f6; margin-top: -6px; cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 2px;
        }
        #aboutModal.hidden { display: none; }
        .phasor-text { font-size: 12px; font-weight: 600; pointer-events: none; font-family: 'Inter', sans-serif; }
        .phasor-label { font-size: 10px; fill: #64748b; font-weight: 500; }
        .phasor-value { font-size: 13px; font-weight: 800; }
        /* Animação suave para o input de tensão */
        #customVoltageContainer { transition: all 0.3s ease; }
    </style>
</head>

<body class="text-slate-300 font-sans antialiased" style="background-image: linear-gradient(to bottom, rgba(15, 23, 42, 0.93), rgba(15, 23, 42, 0.97)), url('https://ecoa.org.br/wp-content/uploads/2015/11/weg-electric-motors-in-stiavelli-warehouse.jpg'); background-size: cover; background-position: center; background-attachment: fixed; background-repeat: no-repeat;">

    <nav class="border-b border-slate-700 bg-slate-900/80 backdrop-blur-md sticky top-0 z-40">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-400" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                </svg>
                <span class="text-white font-bold text-lg tracking-wide">ElektroSys</span>
            </div>
            <div class="flex gap-8 text-sm font-medium text-slate-400">
                <a href="#" class="text-white">Calculadora</a>
                <button id="btnOpenAbout" class="hover:text-white transition focus:outline-none">Sobre</button>
            </div>
        </div>
    </nav>

    <div id="aboutModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md relative overflow-hidden text-brand-text">
            <button id="btnCloseAbout" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 focus:outline-none"><i class="fa-solid fa-xmark text-xl"></i></button>
            <div class="bg-brand-blue p-6 text-white text-center">
                <i class="fa-solid fa-user-tie text-4xl mb-2"></i>
                <h3 class="text-xl font-bold">Gusttavo Gutierry</h3>
                <p class="text-blue-200 text-sm">Engenharia Elétrica & Desenvolvimento</p>
            </div>
            <div class="p-6 space-y-4">
                <p class="text-sm text-gray-600 mb-4 text-center">Entre em contato para projetos ou dúvidas técnicas.</p>
                <a href="https://www.linkedin.com/in/gusttavo-gutierry-ferreira-moraes-bb71841a4/" target="_blank" class="flex items-center gap-4 p-4 rounded-lg border border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition group">
                    <div class="bg-[#0077b5] text-white w-10 h-10 rounded-full flex items-center justify-center"><i class="fa-brands fa-linkedin-in text-lg"></i></div>
                    <div><h4 class="font-bold group-hover:text-blue-700 transition">LinkedIn</h4><p class="text-xs text-gray-500">Conectar perfil profissional</p></div>
                </a>
                <a href="https://wa.me/5564984395286" target="_blank" class="flex items-center gap-4 p-4 rounded-lg border border-gray-200 hover:border-green-500 hover:bg-green-50 transition group">
                    <div class="bg-[#25D366] text-white w-10 h-10 rounded-full flex items-center justify-center"><i class="fa-brands fa-whatsapp text-xl"></i></div>
                    <div><h4 class="font-bold group-hover:text-green-700 transition">WhatsApp</h4><p class="text-xs text-gray-500">+55 64 98439-5286</p></div>
                </a>
            </div>
        </div>
    </div>

    <header class="text-center py-10 px-4 relative z-10">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-3">
            Dimensionamento de cabos para <span class="text-blue-400">Motores Trifásicos</span>
        </h1>
        <p class="text-white font-bold max-w-2xl mx-auto">
            Cálculos automáticos com ajuste de bitola por queda de tensão.<br>
            Altere os valores e veja o resultado em tempo real.
        </p>
    </header>

    <main class="container mx-auto px-4 pb-20 relative z-10">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-4 space-y-4">
                <div class="bg-white rounded-xl shadow-lg p-6 text-brand-text relative">
                    <div class="flex items-center gap-2 mb-6 border-b border-gray-100 pb-2">
                        <i class="fa-solid fa-gear text-blue-600"></i>
                        <h2 class="font-bold text-lg">Parâmetros</h2>
                    </div>

                    <div class="space-y-5">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Potência Mecânica</label>
                            <div class="flex">
                                <input type="number" id="inputPower" value="10" class="w-full border border-gray-300 rounded-l-lg px-3 py-2 focus:outline-none focus:border-blue-500 font-semibold text-gray-700">
                                <select id="inputUnit" class="bg-gray-100 border border-l-0 border-gray-300 rounded-r-lg px-3 py-2 text-sm font-semibold text-gray-600">
                                    <option value="cv">CV</option>
                                    <option value="hp">HP</option>
                                    <option value="kw">kW</option>
                                </select>
                            </div>
                            <div class="text-right text-xs text-gray-400 mt-1">= <span id="displayWatts">7355</span> W</div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Tensão (Trifásico)</label>
                            <div class="grid grid-cols-4 gap-2" id="voltageSelector">
                                <button data-volts="220" class="volt-btn border border-gray-200 rounded py-1.5 text-xs font-bold text-gray-500 hover:bg-gray-50">220V</button>
                                <button data-volts="380" class="volt-btn bg-blue-600 text-white rounded py-1.5 text-xs font-bold shadow-md ring-2 ring-blue-200">380V</button>
                                <button data-volts="440" class="volt-btn border border-gray-200 rounded py-1.5 text-xs font-bold text-gray-500 hover:bg-gray-50">440V</button>
                                <button id="btnCustomVolt" class="volt-btn border border-gray-200 rounded py-1.5 text-xs font-bold text-gray-500 hover:bg-gray-50">Outro</button>
                            </div>
                            <div id="customVoltageContainer" class="hidden mt-2">
                                <div class="flex items-center gap-2">
                                    <input type="number" id="inputCustomVoltage" placeholder="Ex: 480" class="w-full border border-blue-300 rounded px-3 py-1.5 text-sm font-semibold text-gray-700 focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600">
                                    <span class="text-sm font-bold text-gray-500">Volts</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Método de Instalação</label>
                            <select id="installMethod" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm font-semibold text-gray-700 focus:outline-none focus:border-blue-500">
                                <option value="B1">Método B1 - Eletroduto (PVC)</option>
                                <option value="E">Método E - Multipolar (Bandeja)</option>
                                <option value="F_TRI" selected>Método F - Trifólio (Bandeja)</option>
                                <option value="F_JUS">Método F - Justapostos (Bandeja)</option>
                                <option value="G_HOR">Método G - Espaçados (Horizontal)</option>
                            </select>
                            <div id="methodDesc" class="text-xs text-blue-600 mt-1 bg-blue-50 p-2 rounded border border-blue-100">
                                Cabos unipolares em trifólio ao ar livre ou bandejas. (Padrão Industrial)
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between mb-1">
                                <label class="text-xs font-bold text-gray-500">Fator de Potência (cos φ)</label>
                                <span id="displayCos" class="text-xs font-bold text-blue-600">0.85</span>
                            </div>
                            <input type="range" id="inputCos" min="0.5" max="1" step="0.01" value="0.85">
                        </div>

                        <div>
                            <div class="flex justify-between mb-1">
                                <label class="text-xs font-bold text-gray-500">Rendimento (η)</label>
                                <span id="displayEff" class="text-xs font-bold text-green-600">0.90</span>
                            </div>
                            <input type="range" id="inputEff" min="0.5" max="1" step="0.01" value="0.90">
                        </div>

                        <div>
                            <div class="flex justify-between mb-1">
                                <label class="text-xs font-bold text-gray-500">Distância do Quadro</label>
                                <span class="text-xs font-bold text-gray-700"><span id="displayDist">20</span> m</span>
                            </div>
                            <input type="range" id="inputDist" min="1" max="500" value="20">
                        </div>

                        <div>
                            <div class="flex justify-between mb-1">
                                <label class="text-xs font-bold text-gray-500">Temperatura Ambiente</label>
                                <span class="text-xs font-bold text-red-600"><span id="displayTemp">30</span> °C</span>
                            </div>
                            <input type="range" id="inputTemp" min="10" max="80" step="5" value="30">
                            <p class="text-[10px] text-gray-400 mt-1 text-right">Fator de Correção: <span id="displayTempFactor">1.00</span></p>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/80 backdrop-blur-md rounded-lg p-4 border border-slate-700 shadow-inner text-center">
                    <p class="text-[10px] text-slate-400 uppercase tracking-widest mb-1">Cálculo Realizado</p>
                    <div class="text-white text-sm font-serif italic opacity-80">In = P / (√3 · V · cosφ · η)</div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-6">
                <div class="bg-white rounded-xl shadow-lg p-0 overflow-hidden flex flex-col md:flex-row relative min-h-[220px]">
                    <div class="p-6 md:p-8 flex-1 flex flex-col justify-center z-10 border-r border-gray-100">
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-1">Corrente Nominal (In)</p>
                        <h2 class="text-5xl md:text-6xl font-extrabold text-slate-800 mb-2"><span id="resultIn">14.6</span><span class="text-2xl text-gray-500 ml-1">A</span></h2>
                        <div class="inline-flex items-center gap-2 bg-gray-100 rounded-full px-3 py-1 w-max">
                            <span class="text-sm font-semibold text-slate-600">Partida (Ip): <span id="resultIp" class="text-blue-600">~110 A</span></span>
                        </div>
                    </div>
                    
                    <div class="flex-1 bg-gradient-to-br from-gray-50 to-gray-100 relative flex items-center justify-center p-2">
                        <i class="fa-solid fa-bolt text-7xl text-yellow-400 opacity-5 absolute right-2 bottom-2"></i>
                        <div class="w-full h-full flex items-center justify-center">
                            <svg viewBox="0 0 300 220" class="w-full max-w-[320px] drop-shadow-sm" style="overflow: visible;">
                                <defs>
                                    <marker id="arrowP" markerWidth="4" markerHeight="3" refX="3.5" refY="1.5" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,3 L3.5,1.5 z" fill="#EAB308" /></marker>
                                    <marker id="arrowQ" markerWidth="4" markerHeight="3" refX="3.5" refY="1.5" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,3 L3.5,1.5 z" fill="#FACC15" /></marker>
                                    <marker id="arrowS" markerWidth="4" markerHeight="3" refX="3.5" refY="1.5" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,3 L3.5,1.5 z" fill="#475569" /></marker>
                                </defs>
                                <path id="angleArc" fill="none" stroke="#3B82F6" stroke-width="2" opacity="0.6"/>
                                <text id="angleText" class="phasor-text" fill="#3B82F6">φ</text>
                                <line id="lineP" stroke="#EAB308" stroke-width="4" marker-end="url(#arrowP)" stroke-linecap="round"/>
                                <line id="lineQ" stroke="#FACC15" stroke-width="4" stroke-dasharray="6,3" marker-end="url(#arrowQ)" stroke-linecap="round"/>
                                <line id="lineS" stroke="#475569" stroke-width="3" marker-end="url(#arrowS)" stroke-linecap="round"/>
                                <text id="textP" text-anchor="middle" class="phasor-text"><tspan class="phasor-label" fill="#EAB308">Ativa (P)</tspan><tspan id="svgValP" x="0" dy="14" class="phasor-value" fill="#A16207">-- kW</tspan></text>
                                <text id="textQ" text-anchor="start" class="phasor-text"><tspan class="phasor-label" fill="#FACC15">Reativa (Q)</tspan><tspan id="svgValQ" x="0" dy="14" class="phasor-value" fill="#CA8A04">-- kVAr</tspan></text>
                                <text id="textS" text-anchor="end" class="phasor-text"><tspan class="phasor-label" fill="#475569">Aparente (S)</tspan><tspan id="svgValS" x="0" dy="14" class="phasor-value" fill="#1E293B">-- kVA</tspan></text>
                            </svg>
                        </div>
                    </div>
                </div>

                <h3 class="flex items-center gap-2 text-lg font-semibold text-white mt-8">
                    <i class="fa-solid fa-table-cells-large text-blue-400"></i> Sugestão de Componentes
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white rounded-xl p-5 shadow-md border-l-4 border-red-500">
                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider block mb-2">Proteção</span>
                        <h4 id="breakerTitle" class="font-bold text-slate-800">Disjuntor Motor</h4>
                        <div class="text-3xl font-bold text-red-600 mt-2"><span id="resBreaker">20</span> A</div>
                        <p class="text-[10px] text-gray-400 mt-1">Verificar Curva/Ajuste</p>
                    </div>

                    <div class="bg-white rounded-xl p-5 shadow-md border-l-4 border-yellow-400">
                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider block mb-2">Alimentação</span>
                        <h4 id="cableTitle" class="font-bold text-slate-800">Cabo XLPE</h4>
                        <div class="text-3xl font-bold text-slate-800 mt-2"><span id="resCable">2.5</span> <span id="resCableUnit" class="text-lg">mm²</span></div>
                        <p id="dropContainer" class="text-[10px] text-green-600 mt-1">Queda de Tensão: <span id="resDrop">0.92</span>%</p>
                    </div>

                    <div class="bg-white rounded-xl p-5 shadow-md border-l-4 border-blue-500">
                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider block mb-2">Comando</span>
                        <h4 class="font-bold text-slate-800">Contator (AC-3)</h4>
                        <div class="text-3xl font-bold text-slate-800 mt-2">Ie ≥ <span id="resContactor">15</span> A</div>
                        <p class="text-[10px] text-blue-500 mt-1">Relé: <span id="resRelay">11-17</span> A</p>
                    </div>
                </div>

                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r shadow-sm flex gap-3 text-xs text-yellow-800">
                    <i class="fa-solid fa-triangle-exclamation text-yellow-600 mt-1 text-base"></i>
                    <p id="disclaimerText"><strong>Isenção de responsabilidade:</strong> Esta ferramenta é para fins educacionais. Considere a norma NBR 5410.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        const modal = document.getElementById('aboutModal');
        const btnOpen = document.getElementById('btnOpenAbout');
        const btnClose = document.getElementById('btnCloseAbout');
        btnOpen.addEventListener('click', (e) => { e.preventDefault(); modal.classList.remove('hidden'); modal.classList.add('flex'); });
        function closeModal() { modal.classList.add('hidden'); modal.classList.remove('flex'); }
        btnClose.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => { if(e.target === modal) closeModal(); });

        // CALCULADORA
        let currentVoltage = 380;
        let isCustomVoltage = false;
        
        const elPower = document.getElementById('inputPower');
        const elUnit = document.getElementById('inputUnit');
        const elCos = document.getElementById('inputCos');
        const elEff = document.getElementById('inputEff');
        const elDist = document.getElementById('inputDist');
        const elInstall = document.getElementById('installMethod');
        const elMethodDesc = document.getElementById('methodDesc');
        const elTemp = document.getElementById('inputTemp'); 
        const dispTemp = document.getElementById('displayTemp');
        const dispTempFactor = document.getElementById('displayTempFactor');
        
        // Elementos de Tensão
        const btnVolts = document.querySelectorAll('.volt-btn');
        const btnCustomVolt = document.getElementById('btnCustomVolt');
        const customVoltageContainer = document.getElementById('customVoltageContainer');
        const inputCustomVoltage = document.getElementById('inputCustomVoltage');

        const dispWatts = document.getElementById('displayWatts');
        const dispCos = document.getElementById('displayCos');
        const dispEff = document.getElementById('displayEff');
        const dispDist = document.getElementById('displayDist');

        const outIn = document.getElementById('resultIn');
        const outIp = document.getElementById('resultIp');
        const outBreaker = document.getElementById('resBreaker');
        const outBreakerTitle = document.getElementById('breakerTitle');
        const outCable = document.getElementById('resCable');
        const outCableUnit = document.getElementById('resCableUnit');
        const cableTitle = document.getElementById('cableTitle');
        const outDrop = document.getElementById('resDrop');
        const dropContainer = document.getElementById('dropContainer');
        const outContactor = document.getElementById('resContactor');
        const outRelay = document.getElementById('resRelay');
        const disclaimerText = document.getElementById('disclaimerText');

        const svgLineP = document.getElementById('lineP');
        const svgLineQ = document.getElementById('lineQ');
        const svgLineS = document.getElementById('lineS');
        const svgAngleArc = document.getElementById('angleArc');
        const svgAngleText = document.getElementById('angleText');
        const svgValP = document.getElementById('svgValP');
        const svgValQ = document.getElementById('svgValQ');
        const svgValS = document.getElementById('svgValS');
        const textP = document.getElementById('textP');
        const textQ = document.getElementById('textQ');
        const textS = document.getElementById('textS');

        const tempFactors = {
            10: { pvc: 1.22, xlpe: 1.15 }, 15: { pvc: 1.17, xlpe: 1.12 },
            20: { pvc: 1.12, xlpe: 1.08 }, 25: { pvc: 1.06, xlpe: 1.04 },
            30: { pvc: 1.00, xlpe: 1.00 }, 35: { pvc: 0.94, xlpe: 0.96 },
            40: { pvc: 0.87, xlpe: 0.91 }, 45: { pvc: 0.79, xlpe: 0.87 },
            50: { pvc: 0.71, xlpe: 0.82 }, 55: { pvc: 0.61, xlpe: 0.76 },
            60: { pvc: 0.50, xlpe: 0.71 }, 65: { pvc: 0.00, xlpe: 0.65 },
            70: { pvc: 0.00, xlpe: 0.58 }, 75: { pvc: 0.00, xlpe: 0.50 },
            80: { pvc: 0.00, xlpe: 0.41 }
        };

        const installationMethods = {
            'B1': {
                name: "Cabo PVC (B1)",
                desc: "Condutores isolados (70°C) em eletroduto embutido/aparente. (Tabela 36)",
                disclaimer: "Considerado Cabo PVC (70°C), Método B1, 3 condutores carregados.",
                type: 'pvc',
                table: [{sec:1.5,amp:15.5},{sec:2.5,amp:21},{sec:4.0,amp:28},{sec:6.0,amp:36},{sec:10.0,amp:50},{sec:16.0,amp:68},{sec:25.0,amp:89},{sec:35.0,amp:111},{sec:50.0,amp:134},{sec:70.0,amp:171},{sec:95.0,amp:207},{sec:120.0,amp:239},{sec:150.0,amp:275},{sec:185.0,amp:314},{sec:240.0,amp:370}]
            },
            'E': {
                name: "Cabo XLPE (E)",
                desc: "Cabo Multipolar (90°C) em bandeja ventilada ou leito. (Tabela 39)",
                disclaimer: "Considerado Cabo Multipolar XLPE (90°C), Método E, 3 condutores carregados.",
                type: 'xlpe',
                table: [{sec:1.5,amp:23},{sec:2.5,amp:32},{sec:4.0,amp:42},{sec:6.0,amp:54},{sec:10.0,amp:75},{sec:16.0,amp:100},{sec:25.0,amp:127},{sec:35.0,amp:158},{sec:50.0,amp:192},{sec:70.0,amp:246},{sec:95.0,amp:298},{sec:120.0,amp:346},{sec:150.0,amp:399},{sec:185.0,amp:456},{sec:240.0,amp:538}]
            },
            'F_TRI': {
                name: "Cabo XLPE (F-Tri)",
                desc: "Cabos Unipolares (90°C) em TRIFÓLIO sobre bandeja. (Tabela 39)",
                disclaimer: "Considerado Cabo Unipolar XLPE (90°C), Método F (Trifólio), 3 condutores.",
                type: 'xlpe',
                table: [{sec:1.5,amp:21},{sec:2.5,amp:29},{sec:4.0,amp:40},{sec:6.0,amp:53},{sec:10.0,amp:74},{sec:16.0,amp:101},{sec:25.0,amp:135},{sec:35.0,amp:169},{sec:50.0,amp:207},{sec:70.0,amp:268},{sec:95.0,amp:328},{sec:120.0,amp:383},{sec:150.0,amp:444},{sec:185.0,amp:510},{sec:240.0,amp:607}]
            },
            'F_JUS': {
                name: "Cabo XLPE (F-Flat)",
                desc: "Cabos Unipolares (90°C) JUSTAPOSTOS (Plano) sobre bandeja. (Tabela 39)",
                disclaimer: "Considerado Cabo Unipolar XLPE (90°C), Método F (Justapostos), 3 condutores.",
                type: 'xlpe',
                table: [{sec:1.5,amp:22},{sec:2.5,amp:30},{sec:4.0,amp:42},{sec:6.0,amp:55},{sec:10.0,amp:77},{sec:16.0,amp:105},{sec:25.0,amp:141},{sec:35.0,amp:176},{sec:50.0,amp:216},{sec:70.0,amp:279},{sec:95.0,amp:342},{sec:120.0,amp:400},{sec:150.0,amp:464},{sec:185.0,amp:533},{sec:240.0,amp:634}]
            },
            'G_HOR': {
                name: "Cabo XLPE (G-Esp)",
                desc: "Cabos Unipolares (90°C) ESPAÇADOS (Horizontal) sobre bandeja. (Tabela 39)",
                disclaimer: "Considerado Cabo Unipolar XLPE (90°C), Método G (Horizontal Espaçado 1xDe), 3 condutores.",
                type: 'xlpe',
                table: [{sec:1.5,amp:30},{sec:2.5,amp:41},{sec:4.0,amp:56},{sec:6.0,amp:73},{sec:10.0,amp:101},{sec:16.0,amp:137},{sec:25.0,amp:182},{sec:35.0,amp:226},{sec:50.0,amp:275},{sec:70.0,amp:353},{sec:95.0,amp:430},{sec:120.0,amp:500},{sec:150.0,amp:577},{sec:185.0,amp:661},{sec:240.0,amp:781}]
            }
        };

        const standardBreakers = [2, 4, 6, 10, 16, 20, 25, 32, 40, 50, 63, 70, 80, 100, 125, 150, 175, 200, 225, 250, 315, 350, 400, 500, 630, 800, 1000, 1250, 1600];
        const root3 = Math.sqrt(3); 
        const rhoCobre = 0.0172; 
        const maxDropAllowed = 4.0;

        function formatKilo(value) { return (value / 1000).toFixed(1).replace('.', ','); }

        // LOGICA DE TENSÃO
        btnVolts.forEach(btn => {
            btn.addEventListener('click', (e) => {
                // Reset visual dos botões
                btnVolts.forEach(b => { 
                    b.className = "volt-btn border border-gray-200 rounded py-1.5 text-xs font-bold text-gray-500 hover:bg-gray-50"; 
                });
                
                // Ativa o clicado
                e.target.className = "volt-btn bg-blue-600 text-white rounded py-1.5 text-xs font-bold shadow-md ring-2 ring-blue-200";

                if (e.target.id === 'btnCustomVolt') {
                    isCustomVoltage = true;
                    customVoltageContainer.classList.remove('hidden');
                    let customVal = parseFloat(inputCustomVoltage.value);
                    if(customVal > 0) currentVoltage = customVal;
                } else {
                    isCustomVoltage = false;
                    customVoltageContainer.classList.add('hidden');
                    currentVoltage = parseInt(e.target.dataset.volts);
                }
                calculate();
            });
        });

        // Listener do Input Customizado
        inputCustomVoltage.addEventListener('input', (e) => {
            if (isCustomVoltage) {
                let val = parseFloat(e.target.value);
                if (val > 0) {
                    currentVoltage = val;
                    calculate();
                }
            }
        });

        elInstall.addEventListener('change', calculate);
        elTemp.addEventListener('input', calculate);
        elPower.addEventListener('input', calculate);
        elUnit.addEventListener('change', calculate);
        elCos.addEventListener('input', calculate);
        elEff.addEventListener('input', calculate);
        elDist.addEventListener('input', calculate);

        function calculate() {
            let powerVal = parseFloat(elPower.value) || 0;
            let unit = elUnit.value;
            let cosPhi = parseFloat(elCos.value);
            let eff = parseFloat(elEff.value);
            let dist = parseFloat(elDist.value);
            let methodKey = elInstall.value;
            let methodData = installationMethods[methodKey];
            let tempVal = parseInt(elTemp.value);

            let type = methodData.type; 
            let tFactor = tempFactors[tempVal][type] || 1.00;
            
            dispTemp.innerText = tempVal;
            dispTempFactor.innerText = tFactor.toFixed(2);
            if(tFactor === 0) dispTempFactor.innerText = "N/A (Inválido)";

            elMethodDesc.innerText = methodData.desc;
            cableTitle.innerText = methodData.name;
            disclaimerText.innerHTML = `<strong>Isenção de responsabilidade:</strong> ${methodData.disclaimer} Temp: ${tempVal}°C (Fator ${tFactor}). Valide com NBR 5410.`;

            dispCos.innerText = cosPhi.toFixed(2);
            dispEff.innerText = eff.toFixed(2);
            dispDist.innerText = dist;

            let watts = 0;
            if (unit === 'cv') watts = powerVal * 735.5;
            else if (unit === 'hp') watts = powerVal * 745.7;
            else watts = powerVal * 1000;
            
            dispWatts.innerText = Math.round(watts);
            let In = watts / (root3 * currentVoltage * cosPhi * eff);
            if(!isFinite(In) || In < 0) In = 0;
            outIn.innerText = In.toFixed(1);

            let S = (root3 * currentVoltage * In);
            let Q = Math.sqrt(Math.pow(S, 2) - Math.pow(watts, 2));
            if(!isFinite(Q)) Q = 0;

            updatePhasorDiagram(watts, Q, S, cosPhi);

            outBreakerTitle.innerText = (In > 100) ? "Disjuntor Caixa Moldada" : "Disjuntor Motor";
            outIp.innerText = "~" + Math.round(In * 7.5) + " A";

            let targetBreakerCurrent = In * 1.25;
            let selectedBreaker = standardBreakers.find(b => b > targetBreakerCurrent);
            if (!selectedBreaker && In > 0) selectedBreaker = "> 1600"; 
            outBreaker.innerText = selectedBreaker || 0;

            let designCurrent = In; 
            let solutionFound = false;
            let currentTable = methodData.table;
            let maxAmp = currentTable[currentTable.length - 1].amp;

            dropContainer.className = "text-[10px] text-green-600 mt-1";
            outCableUnit.innerText = "mm²";
            outCable.className = "text-3xl font-bold text-slate-800 mt-2";

            if(tFactor > 0) {
                if (!solutionFound) solutionFound = tryFindCable(designCurrent, 1, 1.0, In, dist, currentTable, maxAmp, tFactor);
                if (!solutionFound) { solutionFound = tryFindCable(designCurrent, 2, 0.90, In, dist, currentTable, maxAmp, tFactor); if(solutionFound) cableTitle.innerText = "Sugestão: 2x " + methodData.name; }
                if (!solutionFound) { solutionFound = tryFindCable(designCurrent, 3, 0.90, In, dist, currentTable, maxAmp, tFactor); if(solutionFound) cableTitle.innerText = "Sugestão: 3x " + methodData.name; }
                if (!solutionFound) { solutionFound = tryFindCable(designCurrent, 4, 0.90, In, dist, currentTable, maxAmp, tFactor); if(solutionFound) cableTitle.innerText = "Sugestão: 4x " + methodData.name; }
            } else {
                solutionFound = false;
                cableTitle.innerText = "Temp. Inválida";
            }

            if (!solutionFound && In > 0) {
                if(tFactor === 0) {
                    cableTitle.innerText = "Não Suportado";
                    outCable.innerText = "Temp > Limite";
                } else {
                    cableTitle.innerText = "Barramento / Busway";
                    cableTitle.className = "font-bold text-blue-600";
                    outCable.innerText = "Projeto";
                }
                outCableUnit.innerText = "Espec.";
                outCable.className = "text-2xl font-bold text-blue-600 mt-2";
                dropContainer.className = "text-[10px] text-gray-500 mt-1";
                outDrop.innerText = "-";
            }

            outContactor.innerText = Math.ceil(In);
            let relayMin = (In > 0) ? (In * 0.8).toFixed(1) : 0;
            let relayMax = (In > 0) ? (In * 1.2).toFixed(1) : 0;
            outRelay.innerText = `${relayMin} - ${relayMax}`;
        }

        function updatePhasorDiagram(P, Q, S, cosPhi) {
            svgValP.textContent = formatKilo(P) + " kW";
            svgValQ.textContent = formatKilo(Q) + " kVAr";
            svgValS.textContent = formatKilo(S) + " kVA";
            document.getElementById('angleText').textContent = "φ " + (Math.acos(cosPhi) * 180 / Math.PI).toFixed(0) + "°";

            const originX = 40;  
            const originY = 190; 
            const hypLen = 200;  

            let angleRad = Math.acos(cosPhi);
            let pLen = hypLen * Math.cos(angleRad);
            let qLen = hypLen * Math.sin(angleRad);

            let pEndX = originX + pLen;
            let qEndY = originY - qLen;

            svgLineP.setAttribute('x1', originX); svgLineP.setAttribute('y1', originY);
            svgLineP.setAttribute('x2', pEndX); svgLineP.setAttribute('y2', originY);

            svgLineQ.setAttribute('x1', pEndX); svgLineQ.setAttribute('y1', originY);
            svgLineQ.setAttribute('x2', pEndX); svgLineQ.setAttribute('y2', qEndY);

            svgLineS.setAttribute('x1', originX); svgLineS.setAttribute('y1', originY);
            svgLineS.setAttribute('x2', pEndX); svgLineS.setAttribute('y2', qEndY);

            textP.setAttribute('x', originX + (pLen / 2));
            textP.setAttribute('y', originY + 20); 
            svgValP.setAttribute('x', originX + (pLen / 2));

            textQ.setAttribute('x', pEndX + 10); 
            textQ.setAttribute('y', originY - (qLen / 2));
            svgValQ.setAttribute('x', pEndX + 10);

            textS.setAttribute('x', (originX + pEndX) / 2 - 15); 
            textS.setAttribute('y', (originY + qEndY) / 2 - 10);
            svgValS.setAttribute('x', (originX + pEndX) / 2 - 15);

            let arcR = 40;
            let arcEx = originX + arcR * Math.cos(angleRad);
            let arcEy = originY - arcR * Math.sin(angleRad);
            svgAngleArc.setAttribute('d', `M ${originX + arcR} ${originY} A ${arcR} ${arcR} 0 0 0 ${arcEx} ${arcEy}`);
            svgAngleText.setAttribute('x', originX + arcR + 10);
            svgAngleText.setAttribute('y', originY - 5);
        }

        function tryFindCable(totalCurrent, numCables, groupFactor, loadCurrent, dist, table, maxLimit, tempFactor) {
            let currentPerCable = totalCurrent / (numCables * groupFactor * tempFactor);
            if (currentPerCable > maxLimit) return false;
            let startIndex = table.findIndex(c => c.amp >= currentPerCable);
            if (startIndex === -1) startIndex = table.length - 1;
            let idx = startIndex;
            let drop = 100;
            while (idx < table.length) {
                let singleCableArea = table[idx].sec;
                let totalArea = singleCableArea * numCables; 
                drop = (root3 * rhoCobre * dist * loadCurrent) / (totalArea * currentVoltage) * 100;
                if (drop <= maxDropAllowed) {
                    updateCableUI(table[idx].sec, numCables, drop);
                    return true;
                }
                idx++;
            }
            return false;
        }

        function updateCableUI(section, num, drop) {
            if (num === 1) outCable.innerText = section;
            else outCable.innerText = num + "x " + section;
            outDrop.innerText = drop.toFixed(2);
            if(drop > maxDropAllowed) {
                dropContainer.className = "text-[10px] text-red-600 mt-1 font-bold";
                document.getElementById('resDrop').innerText += "% (ALTA)";
            }
        }

        calculate();
    </script>
</body>
</html>